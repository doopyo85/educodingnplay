<main class="container chat-container">
    <!-- 검색 폼 -->
    <div class="search-box">
        <form id="search-form" method="GET" action="/board/search">
            <select class="search-type" id="search-type" name="searchType">
                <option>글 한 마디</option>
                <option>닉네임</option>
                <option>해시태그</option>
            </select>
            <input type="text" placeholder="검색어..." id="search-value" name="searchValue">
            <button type="submit">검색</button>
        </form>
    </div>

    <!-- 채팅 스타일 게시글 목록 -->
    <div class="chat-box" id="chat-box">
        <% posts.forEach(post => { %>
            <div class="chat-message <% if (user && user.username === post.author) { %> right <% } else { %> left <% } %>">
                <img src="/default-profile.png" class="chat-profile">
                <div class="chat-content">
                    <div class="chat-author"><%= post.author %></div>
                    <div class="chat-text"><%= post.title %></div>
                    <div class="chat-time"><%= post.created_at %></div>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- 입력창 (게시판 하단 고정) -->
    <div class="chat-input-box">
        <input type="text" id="chat-input" placeholder="한마디를 입력하세요 (최대 50자)" maxlength="50">
        <button id="send-btn">⬆</button>
    </div>
</main>

<script>
    document.getElementById('send-btn').addEventListener('click', sendMessage);
    document.getElementById('chat-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });

    function sendMessage() {
        const inputField = document.getElementById('chat-input');
        const message = inputField.value.trim();
        if (!message) return;

        fetch('/board/write', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title: message })
        })
        .then(response => {
            if (response.ok) {
                inputField.value = ''; // 입력창 초기화
                location.reload(); // 새 글 반영
            }
        })
        .catch(error => console.error('에러 발생:', error));
    }
</script>
