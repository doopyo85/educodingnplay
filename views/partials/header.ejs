<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <title>코딩앤아카데미 - 쉽게 배우는 프로그래밍</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/styles.css">
    <script src="https://apis.google.com/js/api.js"></script>

    <!-- 필요한 hidden input 요소 추가 -->
    <input type="hidden" id="googleApiKey" value="<%= process.env.GOOGLE_API_KEY %>">
    <input type="hidden" id="spreadsheetId" value="<%= process.env.SPREADSHEET_ID %>">
    <input type="hidden" id="discoveryDocs" value="<%= process.env.DISCOVERY_DOCS %>">
</head>

<!-- ✅ 헤더 (네비게이션 역할) -->
<header class="header">
    <div class="header-container">
        <!-- 로고 -->
        <a class="brand-logo" href="/">
            <img src="/resource/logo.png" alt="Logo">
            <span>코딩앤아카데미</span>
        </a>

        <!-- 검색창 -->
        <form class="search-form">
            <input class="search-input" type="search" placeholder="검색..." aria-label="검색">
        </form>  

        <!-- 우측 메뉴 -->
        <div class="header-links">
            <% if (typeof role !== 'undefined' && role === 'admin') { %>
                <a href="/admin" class="role-link">Admin</a>
            <% } %> 
            <% if (typeof role !== 'undefined' && role === 'manager') { %>
                <a href="/teacher" class="role-link">Teacher</a>
            <% } %> 

            <!-- 다크 모드 토글 -->
            <i id="toggle-dark-mode" class="bi bi-brightness-high"></i>

            <!-- 알림 아이콘 -->
            <div class="notification-wrapper">
                <i id="notification-icon" class="bi bi-bell"></i>
                <span id="notification-badge" class="badge">New</span>
            </div>

            <!-- 메시지 아이콘 -->
            <i id="app-drawer-button" class="bi bi-chat"></i>

            <!-- 프로필 아이콘 -->
            <img src="/resource/co.ico" alt="Profile" id="profileIcon" class="profile-icon">
            <span id="userName"></span>

            <!-- 로그아웃 버튼 -->
            <button id="logoutButton" class="logout-btn">로그아웃</button>
        </div>
    </div>
</header>

<!-- ✅ 스크립트 -->
<script defer src="/header.js"></script>
<script>
    // 메시지 화면으로 이동
    document.getElementById('app-drawer-button').addEventListener('click', function() {
        window.location.href = '/messages';
    });

    // 알림 배지 표시 처리
    function checkForNewPosts() {
        fetch('/board/check-new-posts')
            .then(response => response.json())
            .then(data => {
                document.getElementById('notification-badge').style.display = data.newPosts ? 'block' : 'none';
            });
    }
    checkForNewPosts();

    // 다크 모드 토글
    document.getElementById('toggle-dark-mode').addEventListener('click', function() {
        document.body.classList.toggle('dark-mode');
    });

    // 비활동 시간 확인 및 자동 로그아웃
    let idleTime = 0;
    function resetIdleTimer() { idleTime = 0; }
    function checkIdleTime() {
        idleTime += 1;
        if (idleTime >= 30) {
            alert("일정시간동안 활동이 없어, 로그아웃되었습니다.");
            window.location.href = '/logout';
        }
    }
    setInterval(checkIdleTime, 60 * 1000);
</script>
