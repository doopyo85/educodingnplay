<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코딩앤플레이 교육사이트 - 쉽게 배우는 프로그래밍</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        function fetchUserData() {
            fetch('/get-user')
                .then(response => response.json())
                .then(data => {
                    document.getElementById("userEmail").innerText = data.email;
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    document.getElementById("userEmail").innerText = "로그인정보미확인";
                });
        }

        window.onload = function() {
            fetchUserData();
        }
    </script>
    <style>
        #sidebar {
            float: left;
            width: 20%;
            background-color: #f1f1f1;
            padding: 10px;
        }
        #content {
            float: left;
            width: 75%;
            margin-left: 5%;
        }
        #userEmail {
            text-align: left; /* 왼쪽 정렬 */
        }
    </style>
</head>

<body>
    <header>
        <h2>TCP/COS/COSpro자격증 준비하기(기출/샘플문제)</h2>
        <div>
            <span id="userEmail">로그인정보미확인</span>
        </div>
    </header>
    <div id="sidebar">
        <!-- Your existing sidebar content -->
    </div>
    <nav class="list-view">
        <ul id="navList"></ul>
    </nav>

    <div class="content-view">
        <div id="content" style="width:100%; height:100%; border:none;"></div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Google Sheets API로 데이터 가져오기
        function loadMenuData() {
            // API 키 및 스프레드시트 ID 설정
            const apiKey = 'AIzaSyAZqp7wFA6uQtlyalJMayyNffqhj1rVgLk';
            const spreadsheetId = '1yEb5m_fjw3msbBYLFtO55ukUI0C0XkJfLurWWyfALok';
            const range = 'A2:C'; // 메뉴 항목 및 링크 열 범위


            gapi.client.init({
                apiKey: apiKey,
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(function () {
                return gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: spreadsheetId,
                    range: range,
                });
            }).then(function (response) {
                const data = response.result.values;

                if (data) {
                    const navList = document.getElementById('navList');
                    const contentView = document.getElementById('content');

                    const topLevelMenus = new Map();

                    data.forEach(function (row) {
                        const topLevelMenu = row[0];
                        const subMenu = row[1];
                        const url = row[2];
                    
                        if (!topLevelMenus.has(topLevelMenu)) {
                            topLevelMenus.set(topLevelMenu, []);
                        }
                    
                        topLevelMenus.get(topLevelMenu).push({ subMenu, url });
                    });
                    
                    topLevelMenus.forEach(function (subMenus, topLevelMenu) {
                        const topLevelMenuItem = document.createElement('li');
                        topLevelMenuItem.textContent = topLevelMenu;
                        topLevelMenuItem.classList.add('has-sub-menu');
                    
                        const arrow = document.createElement('span');
                        arrow.classList.add('arrow', 'arrow-down');
                        topLevelMenuItem.appendChild(arrow);
                    
                        topLevelMenuItem.addEventListener('click', function () {
                            toggleSubMenu(topLevelMenuItem);
                        });
                    
                        const subMenuItems = document.createElement('ul');
                        subMenuItems.className = 'sub-menu';
                        topLevelMenuItem.appendChild(subMenuItems);
                    
                        subMenus.forEach(function (subMenuData) {
                            const subMenuItem = document.createElement('li');
                            subMenuItem.textContent = subMenuData.subMenu;
                    
                            subMenuItem.addEventListener('click', function () {
                                showPageContent(subMenuData.url, contentView);
                                applySubMenuHighlight(subMenuItem);
                            });
                    
                            subMenuItems.appendChild(subMenuItem);
                        });
                    
                        navList.appendChild(topLevelMenuItem);
                    });
                }
            });
        }

        gapi.load('client', loadMenuData);

        function toggleSubMenu(topLevelMenuItem) {
            const subMenu = topLevelMenuItem.querySelector('.sub-menu');
            const arrow = topLevelMenuItem.querySelector('.arrow');

            const allSubMenuItems = document.querySelectorAll('.sub-menu');
            allSubMenuItems.forEach(function (item) {
                if (item !== subMenu) {
                    item.style.maxHeight = '0px';
                }
            });

            if (subMenu.style.maxHeight === '0px' || !subMenu.style.maxHeight) {
                subMenu.style.maxHeight = '1000px';
                subMenu.style.display = 'block';
                toggleArrow(arrow, true);
            } else {
                subMenu.style.maxHeight = '0px';
                subMenu.style.display = 'none';
                toggleArrow(arrow, false);
            }
        }

        function toggleArrow(arrow, isOpen) {
            if (isOpen) {
                arrow.className = 'arrow arrow-up';
            } else {
                arrow.className = 'arrow arrow-down';
            }
        }

        function showPageContent(url, contentView) {
            contentView.innerHTML = `<iframe src="${url}" width="100%" height="100%"></iframe>`;
        }

        function applySubMenuHighlight(selectedSubMenu) {
            const allSubMenus = document.querySelectorAll('.sub-menu li');
            allSubMenus.forEach(function (item) {
                item.classList.remove('active');
            });

            selectedSubMenu.classList.add('active');
        }
    </script>
</body>
</html>
