<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이썬애니웨어 플라스크 애플리케이션</title>
</head>
<body>
    <!-- 플라스크 애플리케이션을 포함하는 iframe -->
    <iframe id="flaskAppFrame" src="https://doopyo85.pythonanywhere.com/" width="100%" height="300px" frameborder="0"></iframe>

    <!-- 코드 에디터 부분 -->
    <div id="app">
        <textarea
            id="codeInput"
            style="margin: 100px auto; width: 100%; max-width: 600px; height: 250px;"
            placeholder="# 여기에 코드를 입력하세요"
            v-model="value"
        ></textarea>
        <button @click="runCode">코드 실행</button>
        <div id="output" style="margin-top: 20px;">
            <p>실행 결과:</p>
            <pre>{{ output }}</pre>
        </div>
    </div>

    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3.3.4"></script>
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    value: '', // 코드 입력을 위한 변수
                    output: '', // 실행 결과를 표시하기 위한 변수 추가
                };
            },
            methods: {
                runCode() {
                    const code = document.getElementById('codeInput').value; // 텍스트 에어리어에서 코드 가져오기

                    // iframe 내부의 플라스크 애플리케이션에 코드 전송
                    const flaskAppFrame = document.getElementById('flaskAppFrame');
                    const message = {
                        type: 'run_code',
                        code: code,
                    };
                    flaskAppFrame.contentWindow.postMessage(message, 'https://doopyo85.pythonanywhere.com/');
                }
            },
            mounted() {
                // 메시지 수신 및 결과 출력
                window.addEventListener('message', event => {
                    if (event.origin === 'https://doopyo85.pythonanywhere.com/') {
                        if (event.data.type === 'code_result') {
                            this.output = event.data.result; // 실행 결과를 output 변수에 저장하여 Vue 데이터와 연결
                        }
                    }
                });
            }
        });
        app.mount("#app");
    </script>
</body>
</html>
